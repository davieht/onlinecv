<!DOCTYPE html>
<html>
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-18M3RKKBG2"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-18M3RKKBG2');
        </script>
        <script type="text/javascript">
        if (location.protocol != 'https:')
        {
        location.href = 'https:' + window.location.href.substring(window.location.protocol.length);
        }
        </script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<!--        <script type="text/javascript">
          google.charts.load("current", {packages:["corechart"]});
          google.charts.setOnLoadCallback(drawChart);
          function drawChart() {
            var data = google.visualization.arrayToDataTable([
              ['Task', 'Hours per Day'],
              ['Trifft voll und ganz zu', 34],
              ['Trifft eher zu', 13],
              ['Teils-teils', 12],
              ['Trifft eher nicht zu', 11],
              ['Trifft gar nicht zu', 24],
              ['Keine Angabe', 6]
            ]);

            var options = {
              title: 'Ich werde mich ehestmöglich impfen lassen',
              pieHole: 0.4,
              slices: {
                  0: { color: '#0072B1' },
                  1: { color: '#93C6DF' },
                  2: { color: '#ffda23' },
                  3: { color: '#F4A683' },
                  4: { color: '#CB001A' },
                  5: { color: '#C1C1C1' }
              }
            };

            var chart = new google.visualization.PieChart(document.getElementById('vaccEmpathyPie'));
            chart.draw(data, options);
          }
        </script>-->
        <title>Pandemieende Österreich</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta property="og:site_name" content="pandemieende.at"/>
        <meta property="og:title" content="Pandemieende" />
        <meta property="og:description" content="Wann ist das Ende der Corona-Pandemie" />
        <meta property="og:image:secure_url" itemprop="image" content="icon.png"/>
        <meta property="og:type" content="website" />
        <meta name="keywords" content="corona, coronavirus, covid, covid-19, SARS-CoV-2, ende, pandemie, pandemieende, impfen, impfrate, Durchimpfung, Pandemiedauer, Herdenimmunität, Österreich"/>
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
        <link rel="icon" type="image/png" href="icon.png" sizes="32x32">
        <link rel="icon" type="image/png" href="icon.png" sizes="96x96">
        <style type="text/css">
            body {font-family: Roboto, sans-serif ;}
            .main {padding-top: 8vw; padding-bottom: 2vw; }
            h1 { font-size: 12vw; }
            h2 { font-size: 4vw; }
            h3 {  }
            .subtext { padding: 32px;}
            .fngroup { padding-top: 32px; }
            .footnote { color: #888; font-size: 12px}
            .donate { padding-top: 32px; padding-bottom: 16px; color: #888}
            .footer {padding: 32px;}
            .links { padding: 32px;}
            .update { padding: 32px; color: #888; font-size: 12px; text-align: left}
            #myProgress { 
                width: 100%; 
                background-color: #ddd; 
                position: relative;
                height: 30px;
            }
            #progressBar {
                width: 0%;
                height: 30px;
                background-color: #ddd;
                text-align: center; /* To center it horizontally (if you want) */
                line-height: 30px; /* To center it vertically */
                color: white;
                position: absolute;
            }
            #heardimmune {
                width: 30%;
                height: 30px;
                background-color: #000;
                line-height:30px;
                left: 70%;
                position: absolute;
                color: forestgreen;
                text-align: left;
                margin-left: 10px;
                background-image: linear-gradient(to right, #ddd, #fff);
            }
            #bar {
                width: 0.3px;
                height: 30px;
                background-color: forestgreen;
                position: absolute;
                left: 70%;
            }
            table.footnote {
                border: none;
            }
            th {
                font-weight: normal;
                text-align: right;
                vertical-align: top;
            }
            td {
                vertical-align: top;
                text-align: left;
            }
            #datatable tbody > tr > td:nth-child(1){
                text-align: right;
                padding-right: 10px
            }
            #vaccEmpathyPie {
                    width: 50vw;
                    height: 20vw;
                }
            @media only screen and (max-width: 600px) {
                h1 { font-size: 18vw}
                h2 { font-size: 8vw}
                #vaccEmpathyPie {
                    width: 100vw;
                    height: 70vw;
                }
            }
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    </head>
    <body>
        <header class="main w3-container">
            <div class="w3-center">
                <h1 id="datum" class="verylarge"></h1>
                <h2 id="tage" class="large"></h2>
                <h3 id="humanisedDate"></h3>
                <div class="subtext"><img src="at.svg" width="16"/> bis eine landesweite Immunität von 70% in Österreich erreicht ist. *</div>
                <div style="margin:1vw 4vw">
                <div>Immunitätsrate **</div>
                    <div id="myProgress">
                        <div id="progressBar"></div>
                        <div id="heardimmune">70%</div>
                        <div id="bar"></div>
                    </div>
                </div>
            </div>
        </header>
        <div class="w3-container">
            <table class="w3-content" id="datatable">
                <tr>
                    <td id="impfPers"></td>
                    <td>zu impfende Personen</td>
                </tr>
                <tr>
                    <td id="impfDos"></td>
                    <td>benötigte Impfdosen</td>
                </tr>
                <tr>
                    <td id="impfRat"></td>
                    <td>aktuelle Impfrate pro Tag (7-Tage-Schnitt)</td>
                </tr>
                <tr>
                    <td id="population"></td>
                    <td>Bevölkerung Österreich (stand 1.1.2020)</td>
                </tr>
                <tr>
                    <td><span id="vaccSum"></span> (<span id="vaccSumPercent"></span>)</td>
                    <td>Impfungen Summe</td>
                </tr>
                <tr>
                    <td><span id="vaccFirst"></span> (<span id="vaccFirstPercent"></span>)</td>
                    <td>Teilimpfungen (1. Dosis)</td>
                </tr>
                <tr>
                    <td><span id="vaccSecond"></span> (<span id="vaccSecondPercent"></span>)</td>
                    <td>Vollimmunisierte (2. Dosis)</td>
                </tr>
            </table>
<!--            <div class="w3-content">
                <p class="w3-center">Impfbereitschaft</p>
                <div id="vaccEmpathyPie"></div>
                <div class="w3-right footnote">Daten von <a href="https://viecer.univie.ac.at/corona-blog/corona-blog-beitraege/corona-dynamiken19/">ACPP (Austrian Corona Panel Project)</a> Stand 26.1.2021</div>
            </div>-->
            <div class="w3-content w3-center">
                <h4>Wann werde ich geimpft?</h4>
                <form action="">
                    <div><label for="birthday" style="">Geburtstag</label></div>
                    <input type="date" id="birthday" name="birthday">
                    <input id="bdbutton" type="button" value="Berechnen"/>
                </form>
                <div id="impfdategroup" style="display:none">
                    <p>Sie werden voraussichtlich am</p>
                    <h4 id="impfdate"></h4>
                    <p>geimpft***</p>
                </div>
            </div>
            <div class="w3-content w3-center links">
                <div><a href="https://www.sozialministerium.at/Corona-Schutzimpfung/Corona-Schutzimpfung---Haeufig-gestellte-Fragen.html" target="_blank">Warum sollte ich mich impfen lassen? (FAQ)</a></div>
                <div><a href="https://info.gesundheitsministerium.gv.at/" target="_blank">Impfdashboard</a></div>
                <div><a href="https://covid19-dashboard.ages.at/" target="_blank">Aktuelle Zahlen zu Covid</a></div>
            </div>
            <div class="w3-center w3-center">
                <div><img src="de.svg" width="16"/> <a href="https://pandemieende.de">Pandemieende Deutschland</a></div>
                <div><img src="ch.svg" width="16"/> <a href="https://pandemieende.ch">Pandemieende Schweiz</a></div>
            </div>
            <div class="w3-content w3-center">
                <table class="w3-content footnote fngroup">
                    <tr>
                        <th>*</th>
                        <td>Das Datum errechnet sich aus der Zeitspanne, die bemessen an der aktuellen Impfrate (gemessen am 7-Tage-Schnitt) benötigt wird, um eine Herdenimmunität von 70% der Gesamtbevölkerung (Stand 1.1.2020) zu erreichen; abzüglich der genesenen Personen; abzüglich jener Personen, welche die zweite Impfdosis bekommen haben.</td>
                    </tr>
                    <tr>
                        <th>**</th>
                        <td>Die Immunitätsrate errechnet sich aus der Anzahl der bereits genesenen Personen, plus der Anzahl jener Personen, die bereits die zweite Impfdosis erhalten haben; gemessen der Gesamtbevölkerung (Stand 1.1.2020)</td>
                    </tr>
                    <tr>
                        <th>***</th>
                        <td>Die Berechnung ermittelt das Datum ihrer Erstimpfung anhand der Impfrate, gemessen an der Bevölkerungsverteilung nach Alter. Das bedeutet, je älter Sie sind, desto früher kommen sie dran.</td>
                    </tr>
                    <tr>
                        <th></th>
                        <td>Letztes Update um 09:15</td>
                    </tr>
                </table>
                <div class="donate">Sie finden die Idee toll? Spendieren Sie mir ein Bier :)</div>
                <div>
                    <form action="https://www.paypal.com/donate" method="post" target="_top">
                    <input type="hidden" name="business" value="2PKXWXNHMQ9SU" />
                    <input type="hidden" name="currency_code" value="EUR" />
                    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
                    <img alt="" border="0" src="https://www.paypal.com/en_AT/i/scr/pixel.gif" width="1" height="1" />
                    </form>
                </div>
                <div class="update">
                    <p>Update: (6.2.2021)</p>
                    <ul>
                        <li>Typos fixed</li>
                        <li>Neues Feature: Impfrechner</li>
                    </ul>
                    <p>Update: (29.1.2021)</p>
                    <ul>
                        <li>Neue Berechnung des Enddatums aufgrund neuer Datelage (1. und 2. Impfdosis, bzw. gesamte Impfungen).</li>
                        <li>Neue Berechnung der Immunitätsrate aufgrund neuer Datelage (1. und 2. Impfdosis, bzw. gesamte Impfungen). Die Immunitätsrate berechnet sich nun aus der Gesamtbevölkerung</li>
                        <li>Genauere Beschreibung zur Aufschlüsselung der Berechnungen</li>
                        <li>Zeitangabe in Jahre, Monate, Tage hinzugefügt</li>
                        <li>Immunitätsrate-Balken Designverbesserungen</li>
                        <li>Neue Werte hinzugefügt: 
                            <ul>
                                <li>Impfungen Summe - Gesamt Verimpfte Dosen (Prozentsatz gemessen an der Gesamtbevölkerung)</li>
                                <li>Teilimpfungen (1. Dosis) - Summe der Erstimpfungen</li>
                                <li>Vollimmunisierte (2. Dosis)- Summe der Zweitimpfungen</li>
                                <li>Bevölkerungsstand (1.1.2020)</li>
                            </ul>
                        </li>
                        <li>Verbesserte Lesbarkeit des JavaScript-Codes</li>
                    </ul>
                </div>
                <div class="footnote">Auch wenn diese Seite offizielle Quellen und Links verwendet, ist sie keine öffentliche Seite des Bundes. Pandemieende.at wird nicht von öffentlichen Geldern unterstützt, sondern ist ein privates Unterfangen. Die Seite wird laufend weiterentwickelt. Die Daten sind noch unvollständig, da sich die Infrastruktur zur flächendeckenden Eintragung seitens der Behörden noch im Aufbau befindet. Die Einmeldequote beträgt derzeit ca. 80%</div>
            </div>
        </div>
        <footer class="footer w3-white w3-center">            
            <div>Made with <span style="color: red">&#10084;</span> by "Daveloper"</div>
            <div>
                <span>Datenquellen: <a href="https://www.ages.at/">AGES</a>, <a href="https://www.statistik.at/">Statistik Austria</a>, <a href="https://www.data.gv.at/covid-19">BMSGPK, Österreichisches COVID-19 Open Data Informationsportal</a></span>, <span><a href="https://viecer.univie.ac.at/corona-blog/corona-blog-beitraege/corona-dynamiken19/">ACPP (Austrian Corona Panel Project)</a></span> | <span><a href="impressum.html">Impressum</a></span> | <span><a href="mailto:daveloper@pandemieende.at">Kontakt</a></span> | <span><a href="https://www.pandemieende.de">Pandemieende Deutschland</a></span> | <span><a href="https://www.pandemieende.ch">Pandemieende Schweiz</a></span> | <span>Alle Angaben ohne Gewähr</span>
            </div>
        </footer>
    </body>
    <script type="text/javascript">
        
        Array.prototype.last = function() {
            return this.slice(-1)[0];
        };
        
        String.prototype.asRoundInt = function() {
            let parsed = parseInt(this);
            if (isNaN(parsed)) {
                parsed = 0;
            }
            return Math.round(parsed);
        };
        
        Number.prototype.asRoundStr = function() {
            return Math.round(this).toLocaleString("de-AT");
        };
        
        String.prototype.toInt = function() {
            return parseInt(this);
        };
        
        function humanise(total_days)
        {
            //var total_days = 1001;
            var date_current = new Date();
            var utime_target = date_current.getTime() + total_days*86400*1000;
            var date_target = new Date(utime_target);

            var diff_year  = parseInt(date_target.getUTCFullYear() - date_current.getUTCFullYear());
            var diff_month = parseInt(date_target.getUTCMonth() - date_current.getUTCMonth());
            var diff_day   = parseInt(date_target.getUTCDate() - date_current.getUTCDate());

            var days_in_month = [31, (date_target.getUTCFullYear()%4?29:28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            var date_string = "";
            while(true)
            {
                date_string = "";
                date_string += (diff_year>0?diff_year + " Jahre ":"");

                if(diff_month<0){diff_year -= 1; diff_month += 12; continue;}
                date_string += (diff_month>0?diff_month + " Monate ":"");

                if(diff_day<0){diff_month -= 1; diff_day += days_in_month[((11+date_target.getUTCMonth())%12)]; continue;}
                date_string += (diff_day>0?diff_day + " Tage":"");
                break;
            }
            console.log(date_string);
            return date_string;
        }
        
        function csvJSON(csv){
            return csv.split("\n").map(element => element.split(";"));
        }
        
        function getGenesen(arr) {
            return parseInt(arr.last()[11]);
        }
        
        function getVaccRate(arr) {
            //return Math.round((arr[arr.length - 1][1] - arr[arr.length - 8][1]) / 7);
            arr = arr.filter(row => row[1] === '10');
            return Math.round((arr[arr.length - 1][8] - arr[arr.length - 8][8]) / 7);
            //return Math.round((arr[arr.length - 1][1]) / arr.length); alternative Berechnung: der Durchschnitt über alle Tage seit Impfbegin. Aufgrund der dramatischen Verlängerung der Zeitspanne wird eine Berechnung über die letzten 7 Tage bevorzugt.
        }
        
        function getColor(value, light){
            var hue=((value)*120).toString(10);
            return ["hsl(",hue,",70%,",light,"%)"].join("");
        }
        
        const impfWillig = 0.17;            // Anzahl der Impfwilligen
        const herdenImmun = 0.7;            // Herdenimmunität von 70%
        
        $.get("timeline.csv?_=" + new Date().getTime(), function(impfData, status) {
            $.get("CovidFaelle_Timeline.csv?_=" + new Date().getTime(), function(allgData, status) {
                let csvVaccArr = csvJSON(`${impfData}`);
                let population = csvVaccArr.last()[3].toInt(); // Gesamtbevölkerung Österreich

                let isVacc = csvVaccArr.last()[8].toInt();    // Anzahl an bisher geimpften Personen
                let recovered = getGenesen(csvJSON(`${allgData}`));                  // Anzahl der bisher genesenen Personen https://info.gesundheitsministerium.at/data/AllgemeinDaten.csv
                let vaccRate = getVaccRate(csvVaccArr);     // Impfungen pro Tag im 7-Tage-Schnitt https://info.gesundheitsministerium.gv.at/data/timeline.csv
                let sumVaccImmune = csvVaccArr.last()[12].toInt();

                let sumImmune = sumVaccImmune + recovered;    // Anzahl an immunisierten Personen
                let vaccLeft = population * .7 - sumImmune; // Noch zu impfende Bevölkerung
                let impfungen = vaccLeft * 2 - isVacc;           // Derzeit müssen 2 Impfdosen pro Person verabreicht werden
                let isImmunePercent = (sumImmune / population) * 100;

                let daysSum = Math.round(impfungen / vaccRate); // Tage die benötigt werden um bei derzeitiger Impfrate die Herdenimmunität zu erreichen
                let endDate = new Date().setDate(new Date().getDate() + daysSum); // Enddatum

                document.getElementById("datum").innerHTML = new Date(endDate).toLocaleDateString("de-AT");
                document.getElementById("tage").innerHTML = "Noch " + daysSum + " Tage";
                document.getElementById("humanisedDate").innerHTML = humanise(daysSum);
                document.getElementById("impfPers").innerHTML = vaccLeft.asRoundStr();
                document.getElementById("impfDos").innerHTML = impfungen.asRoundStr();
                document.getElementById("impfRat").innerHTML = vaccRate.asRoundStr();
                document.getElementById("population").innerHTML = population.asRoundStr();
                document.getElementById("vaccSum").innerHTML = csvVaccArr.last()[8].toInt().toLocaleString("de-AT");;
                document.getElementById("vaccSumPercent").innerHTML = (csvVaccArr.last()[8].toInt() / population * 100).toFixed(2) + "&nbsp;%";
                document.getElementById("vaccFirst").innerHTML = csvVaccArr.last()[10].toInt().toLocaleString("de-AT");;
                document.getElementById("vaccFirstPercent").innerHTML = (csvVaccArr.last()[10].toInt() / population * 100).toFixed(2) + "&nbsp;%";
                document.getElementById("vaccSecond").innerHTML = csvVaccArr.last()[12].toInt().toLocaleString("de-AT");;
                document.getElementById("vaccSecondPercent").innerHTML = (csvVaccArr.last()[12].toInt() / population * 100).toFixed(2) + "&nbsp;%";

//                document.getElementById("myProgress").style.backgroundColor = getColor(istImmunPercent * .01, 90);
                document.getElementById("progressBar").style.backgroundColor = getColor(isImmunePercent * .01, 50);
                document.getElementById("progressBar").style.width = (isImmunePercent) + "%";
                document.getElementById("progressBar").innerHTML = (isImmunePercent).toFixed(2) + "%";
                
                const bev = [435835, 425227, 421998, 437855, 517770, 601402, 607628, 610304, 564441, 622453, 711404, 685485, 565635, 450381, 391654, 377545, 247722, 143216, 65714, 17395];
        
                document.getElementById("bdbutton").onclick = function() {
                    let bday = Date.parse(document.getElementById("birthday").value);   // Datum
                    let diff = Date.now() - bday;                                       // Differenz Interval
                    let age = new Date(diff).getUTCFullYear() - 1970;                   // Alter
                    let idx = Math.floor(age / 5);                                      // index von bev
                    let sum = 0;
                    for (i = bev.length - 1; i > idx; i--) {
                        sum += bev[i];
                    }
                    let perc = sumImmune / population;                                       // Immunanteil der Gesamtbevölkerung
                    let days = ((sum - (sum * perc)) / vaccRate) * 2;                   // Anzahl Tage = Summe an Priorisierten - Immune priorisierter Bevölkerung * 2 (wobei 2 Anzahl der Benötigten Impfdosen ist)
                    let enddate = new Date().setDate(new Date().getDate() + days);
                    document.getElementById("impfdate").innerHTML = new Date(enddate).toLocaleDateString("de-AT");
                    document.getElementById("impfdategroup").style.display = "block";
                };
            });
        });
        
        
      
    </script>
</html>
