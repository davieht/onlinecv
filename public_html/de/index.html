<html>
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-EQRDD3BQED"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-EQRDD3BQED');
        </script>
        <script type="text/javascript">
        if (location.protocol != 'https:' && location.hostname !== 'localhost')
        {
        location.href = 'https:' + window.location.href.substring(window.location.protocol.length);
        }
        </script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
        
        <title>Pandemieende Deutschland</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="title" content="pandemieende.de"/>
        <meta name="description" content="Wann ist das Ende der Corona-Pandemie? Diese Seite berechnet anhand der Impfdaten das Datum an dem die Herdenimmunität in Deutschland erreicht wird."/>
        <meta property="og:site_name" content="pandemieende.de"/>
        <meta property="og:title" content="Pandemieende Deutschland" />
        <meta property="og:description" content="Wann ist das Ende der Corona-Pandemie? Diese Seite berechnet anhand der Impfdaten das Datum an dem die Herdenimmunität in Deutschland erreicht wird." />
        <meta property="og:image:secure_url" itemprop="image" content="icon.png"/>
        <meta property="og:type" content="website" />
        <meta name="keywords" content="corona, coronavirus, covid, covid-19, SARS-CoV-2, ende, pandemie, pandemieende, impfen, impfrate, Durchimpfung, Pandemiedauer, Herdenimmunität, Deutschland"/>
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
        <link rel="stylesheet" href="https://pandemieende.at/style/style.css"/>
        <link rel="icon" type="image/png" href="icon.png" sizes="32x32">
        <link rel="icon" type="image/png" href="icon.png" sizes="96x96">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://pandemieende.at/js/utils.js"></script>
    </head>
    <body>
        <div class="main w3-container">
            <div class="w3-center w3-content">
                <h1 id="date" class="verylarge"></h1>
                <h2 id="days" class="large"></h2>
                <h3 id="humanizedDate"></h3>
                
                <div class="subtext"><img src="src/de.svg" width="16"/>&nbsp;bis eine landesweite Immunität von 70% in Deutschland erreicht ist. *</div>
                <div class="w3-panel w3-border-red w3-pale-red w3-text-red">
                    <p>Neue Website mit Daten aus der ganzen Welt online! <a href="https://pandemicend.info">pandemicend.info</a></p>
                </div>
                
                <div>Immunitätsrate **</div>
                <div id="mainProgress">
                    <div id="progressBar"></div>
                    <div id="heardimmune">70%</div>
                    <div id="bar"></div>
                </div>
                <p class="footnote">Datenlage Stand <span id="update-date"></span></p>
                
                <h3>Allgemeine Daten</h3>
                
                <div>
                    <div class="bubble">
                        <p id="population"></p>
                        <p>Bevölkerung Deutschland<br/>(stand 1.1.2020)</p>
                    </div>
                </div>
                <div>
                    <div class="bubble">
                        <p id="vaccPers"></p>
                        <p>zu impfende Personen</p>
                    </div>
                    <div class="bubble">
                        <p id="vaccDose"></p>
                        <p>benötigte Impfdosen</p>
                    </div>
                    
                    <div class="bubble" style="background-color:hsl(211, 100%, 93%)">
                        <p id="vaccSum"></p>
                        <p id="vaccSumDelta"></p>
                        <p>Impfungen Summe</p>
                    </div>
                    <div class="bubble" style="background-color:hsl(211, 100%, 87%)">
                        <p id="vaccFirst"></p>
                        <p id="vaccFirstDelta"></p>
                        <p>Teilimpfungen</p>
                    </div>
                    <div class="bubble" style="background-color:hsl(211, 100%, 80%)">
                        <p id="vaccSecond"></p>
                        <p id="vaccSecondDelta"></p>
                        <p>Vollimmunisierte</p>
                    </div>
                    <div class="bubble">
                        <p id="vaccRate"></p>
                        <p id="vaccRateDelta"></p>
                        <p>Impfrate<br/>(7-Tage-Schnitt)</p>
                    </div>
                </div>
                <div>
                    <div class="bubble" style="background-color:hsl(40, 100%, 90%)">
                        <p id="infected"></p>
                        <p id="infectedDelta"></p>
                        <p>Infizierte ges.</p>
                    </div>
                    <div class="bubble" style="background-color:hsl(120, 100%, 90%)">
                        <p id="recovered"></p>
                        <p id="recoveredDelta"></p>
                        <p>Genesene</p>
                    </div>
                    <div class="bubble" style="background-color:hsl(0, 0%, 30%);color:white">
                        <p id="casualties"></p>
                        <p id="casualtiesDelta"></p>
                        <p>Todesopfer</p>
                    </div>               
                    <div class="bubble" style="background-color:hsl(40, 100%, 90%)">
                        <p id="infectedCurrent"></p>
                        <p id="infectedCurrentDelta"></p>
                        <p>Infizierte aktuell</p>
                    </div>
                    <div class="bubble" style="background-color:hsl(20, 100%, 90%)">
                        <p id="hospital"></p>
                        <p id="hospitalDelta"></p>
                        <p>Hostpitalisierte</p>
                    </div>
                    <div class="bubble" style="background-color:hsl(0, 100%, 90%)">
                        <p id="intensiveCare"></p>
                        <p id="intensiveCareDelta"></p>
                        <p>Intensivpatienten</p>
                    </div>
                         
                    <div class="bubble">
                        <p id="tests"></p>
                        <p id="testsDelta"></p>
                        <p>Testungen</p>
                    </div>
                    <div class="bubble">
                        <p id="incidence"></p>
                        <p id="incidenceDelta"></p>
                        <p>7-Tage-Inzidenz</p>
                    </div>
                </div>
            </div>
            
            <div class="w3-content w3-center" style="min-width: 300px!important">
                <h3>Impfrate 7-Tage-Schnitt</h3>
                <canvas id="vaccChart"></canvas>
            </div>
            
            <div class="w3-content w3-center links">
                <div><a href="https://www.zusammengegencorona.de/impfen/" target="_blank">Warum sollte ich mich impfen lassen? (FAQ)</a></div>
                <div><a href="https://impfdashboard.de" target="_blank">Impfdashboard</a></div>
                <div><a href="https://www.bundesregierung.de/breg-de/themen/coronavirus/fallzahlen-coronavirus-1738210" target="_blank">Aktuelle Zahlen zu Covid</a></div>
            </div>
            <div class="w3-center w3-center">
                <div><img src="src/de.svg" width="16"/> <a href="https://pandemicend.info">Pandemieende Weltweit</a></div>
                <div><img src="src/at.svg" width="16"/> <a href="https://pandemieende.at">Pandemieende Österreich</a></div>
                <div><img src="src/ch.svg" width="16"/> <a href="https://pandemieende.ch">Pandemieende Schweiz</a></div>
            </div>
            <div class="w3-content w3-center">
                <table class="w3-content footnote fngroup">
                    <tr>
                        <th>*</th>
                        <td>Das Datum errechnet sich anhand der aktuellen Impfrate (gemessen am 7-Tage-Schnitt) um eine Herdenimmunität von 70% der Gesamtbevölkerung (Stand 1.1.2020) zu erreichen; abzüglich jener Personen, welche bereits Impfungen bekommen haben.</td>
                    </tr>
                    <tr>
                        <th>**</th>
                        <td>Die Immunitätsrate errechnet sich aus der Anzahl jener Personen, die bereits die zweite Impfdosis erhalten haben; gemessen an der Gesamtbevölkerung (Stand 1.1.2020)</td>
                    </tr>
                    <tr>
                        <th></th>
                        <td>Updates täglich um 12:15</td>
                    </tr>
                </table>
                <div class="donate">Sie finden die Idee toll? Spendieren Sie mir ein Bier :)</div>
                <div>
                    <form action="https://www.paypal.com/donate" method="post" target="_top">
                    <input type="hidden" name="business" value="2PKXWXNHMQ9SU" />
                    <input type="hidden" name="currency_code" value="EUR" />
                    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
                    <img alt="" border="0" src="https://www.paypal.com/en_AT/i/scr/pixel.gif" width="1" height="1" />
                    </form>
                </div>
                <div class="update toggle" onclick="toggleChangelog(this)">
                    <h4 id="changelog">Changelog:</h4>
                    <p>Update: (8.5.2021)</p>
                    <ul>
                        <li>Berechnung Enddatum berichtigt. Bereits Geimpfte wurden doppelt abgezogen.</li>
                        <li>Absolute Zahlen zu Allgemeine Daten hinzugefügt.</li>
                        <li>Texte angepasst.</li>
                    </ul>
                    <p>Update: (2.5.2021)</p>
                    <ul>
                        <li>Neue (alte) Berechnung des finalen Datums: Unter-16-Jährige werden nun wieder mit einberechnet. Aufgrund der neuer Datenlage tragen Kinder, Jugendliche und Erwachsene gleichermaßen zum Infektionsgeschehen bei. Das aktuelle Datum verschiebt sich deshalb in die Zukunft.</li>
                        <li>Styling issues fixed</li>
                    </ul>
                    <p>Update: (28.4.2021)</p>
                    <ul>
                        <li>Neue Berechnung 1: Unter-16-Jährige werden nicht mehr mit einberechnet</li>
                        <li>Neue Berechnung-2: Genesene werden nicht mehr mit einberechnet.</li>
                        <li>Aufgrund der neuen Datenlage, die eingangs nicht verfügbar war, werden die Werte neu berechnet. Bisher wurden Unter-16-Jährige auch gezählt. Anfangs ging man davon aus, dass Genesene bereits eine vollständige Immunität haben. Neueste Auswertungen ergeben jedoch, dass dies nur teilweise der Fall ist. Aufgrund von Häufungen von erneute Infektionen empfiehlt die WHO nun doch auch Genese Personen zu impfen. Weil einige Genesene auch eine zweite Impfdosis erhalten haben wurden diese doppelt gezählt (sowohl genesen als auch vollimmun) und haben somit das Enddatum bzw. die Immunitätsrate verfälscht.</li>
                        <li>Design Issues bereinigt</li>
                        <li>Zeitlicher Verlauf hinzugefügt</li>
                    </ul>
                    <p>Update: (24.2.2021)</p>
                    <ul>
                        <li>Daten bereinigt. Es wurden falsche Zahlen der API verwendet. Demnach haben sich einige Werte auf der Seite geändert.</li>
                    </ul>
                    <p>Update: (6.2.2021)</p>
                    <ul>
                        <li>Typos fixed</li>
                        <li>Neues Feature: Impfrechner</li>
                    </ul>
                    <p>Update: (29.1.2021)</p>
                    <ul>
                        <li>Neue Berechnung des Enddatums aufgrund neuer Datelage (1. und 2. Impfdosis, bzw. gesamte Impfungen).</li>
                        <li>Neue Berechnung der Immunitätsrate aufgrund neuer Datelage (1. und 2. Impfdosis, bzw. gesamte Impfungen). Die Immunitätsrate berechnet sich nun aus der Gesamtbevölkerung</li>
                        <li>Genauere Beschreibung zur Aufschlüsselung der Berechnungen</li>
                        <li>Zeitangabe in Jahre, Monate, Tage hinzugefügt</li>
                        <li>Immunitätsrate-Balken Designverbesserungen</li>
                        <li>Neue Werte hinzugefügt: 
                            <ul>
                                <li>Impfungen Summe - Gesamt Verimpfte Dosen (Prozentsatz gemessen an der Gesamtbevölkerung)</li>
                                <li>Teilimpfungen (1. Dosis) - Summe der Erstimpfungen</li>
                                <li>Vollimmunisierte (2. Dosis)- Summe der Zweitimpfungen</li>
                                <li>Bevölkerungsstand (1.1.2020)</li>
                            </ul>
                        </li>
                        <li>Verbesserte Lesbarkeit des JavaScript-Codes</li>
                    </ul>
                </div>
                <div class="footnote">Auch wenn diese Seite offizielle Quellen und Links verwendet, ist sie keine öffentliche Seite des Bundes. Pandemieende.de wird nicht von öffentlichen Geldern unterstützt, sondern ist ein privates Unterfangen.</div>
            </div>     
        </div>
        <footer class="footer w3-white w3-center">            
            <div>Made with <span style="color: red">&#10084;</span> by "Daveloper"</div>
            <div>
                <span>Datenquellen: RKI (Robert Koch Institut), destatis (Statistisches Bundesamt), impfdashboard.de</span> | <span><a href="impressum.html">Impressum</a></span> | <span><a href="mailto:daveloper@pandemieende.at">Kontakt</a></span> | <span><a href="https://www.pandemicend.info">Pandemieende Weltweit</a></span> | <span><a href="https://www.pandemieende.at">Pandemieende Östereich</a></span> | <span><a href="https://www.pandemieende.ch">Pandemieende Schweiz</a></span> | <span>Alle Angaben ohne Gewähr</span>
            </div>
        </footer>
    </body>
    <script type="text/javascript">
        
        const POPULATION = 83190556; // Gesamtbevölkerung Deutschland
        const RECOVERED = 2287850;
        const HEARD_IMMUN = .7;
        const UNDER_SIXTEEN = 12166082;
        
        const VACC_SUM_COL = 1;
        const VACC_FIRST_COL = 8;
        const VACC_FULL_COL = 9
        
        function csvJSON(csv){
            return csv.trim().split("\n").map(element => element.split("\t"));
        }
        
        function getVaccRate(arr, prev) {
            if (!prev) {
                prev = 0;
            }
            return Math.round((arr[arr.length - (1 + prev)][VACC_SUM_COL] - arr[arr.length - (8 + prev)][VACC_SUM_COL]) / 7);
        }
        
        $.get("data/germany_vaccinations_timeseries_v2.tsv?_=" + new Date().getTime(), function(impfData, status) {
            let csvVaccArr = csvJSON(`${impfData}`);

            let isVacc = csvVaccArr.last()[VACC_SUM_COL].toInt();    // Anzahl an bisher geimpften Personen
            let vaccRate = getVaccRate(csvVaccArr);     // Impfungen pro Tag im 7-Tage-Schnitt https://info.gesundheitsministerium.gv.at/data/timeline.csv
            let sumVaccImmune = csvVaccArr.last()[VACC_FULL_COL].toInt();

            let vaccLeft = POPULATION * HEARD_IMMUN - sumVaccImmune; // Noch zu impfende Bevölkerung
            let impfungen = (POPULATION * HEARD_IMMUN) * 2 - isVacc;           // Derzeit müssen 2 Impfdosen pro Person verabreicht werden
            let isImmunePercent = (sumVaccImmune / POPULATION) * 100;

            let daysSum = Math.round(impfungen / vaccRate); // Tage die benötigt werden um bei derzeitiger Impfrate die Herdenimmunität zu erreichen
            let endDate = new Date().setDate(new Date().getDate() + daysSum); // Enddatum

            document.getElementById("date").innerHTML = new Date(endDate).toLocaleDateString("de-AT");
            document.getElementById("days").innerHTML = `Noch ${daysSum} Tage`;
            document.getElementById("humanizedDate").innerHTML = humanise(daysSum);
            document.getElementById("vaccPers").innerHTML = vaccLeft.asRoundStr();
            document.getElementById("vaccDose").innerHTML = impfungen.asRoundStr();
            document.getElementById("vaccRate").innerHTML = vaccRate.asRoundStr();
//            document.getElementById("vaccRateDelta").innerHTML = (vaccRate - getVaccRate(csvVaccArr, 1)).toSignedString();
            document.getElementById("population").innerHTML = POPULATION.asRoundStr();
            document.getElementById("vaccSum").innerHTML = csvVaccArr.last()[VACC_SUM_COL].toInt().toLocaleString("de-AT");
            document.getElementById("vaccSumDelta").innerHTML = `+${(csvVaccArr.last()[VACC_SUM_COL].toInt() - csvVaccArr.last(1)[VACC_SUM_COL].toInt()).toLocaleString("de-AT")}`;
//            document.getElementById("vaccSumPercent").innerHTML = (csvVaccArr.last()[1].toInt() / POPULATION * 100).toFixed(2) + "&nbsp;%";
            document.getElementById("vaccFirst").innerHTML = csvVaccArr.last()[VACC_FIRST_COL].toInt().toLocaleString("de-AT");
            document.getElementById("vaccFirstDelta").innerHTML = `+${(csvVaccArr.last()[VACC_FIRST_COL].toInt() - csvVaccArr.last(1)[VACC_FIRST_COL].toInt()).toLocaleString("de-AT")}`;
//            document.getElementById("vaccFirstPercent").innerHTML = (csvVaccArr.last()[8].toInt() / POPULATION * 100).toFixed(2) + "&nbsp;%";
            document.getElementById("vaccSecond").innerHTML = csvVaccArr.last()[VACC_FULL_COL].toInt().toLocaleString("de-AT");
            document.getElementById("vaccSecondDelta").innerHTML = `+${(csvVaccArr.last()[VACC_FULL_COL].toInt() - csvVaccArr.last(1)[VACC_FULL_COL].toInt()).toLocaleString("de-AT")}`;
//            document.getElementById("vaccSecondPercent").innerHTML = (csvVaccArr.last()[9].toInt() / POPULATION * 100).toFixed(2) + "&nbsp;%";
//            document.getElementById("recovered").innerHTML = RECOVERED.asRoundStr();
//            document.getElementById("recoveredPercent").innerHTML = (RECOVERED / POPULATION * 100).toFixed(2) + "&nbsp;%";

//                document.getElementById("myProgress").style.backgroundColor = getColor(istImmunPercent * .01, 90);
            document.getElementById("progressBar").style.backgroundColor = getColor(isImmunePercent * .01, 50);
            document.getElementById("progressBar").style.width = `${isImmunePercent}%`;
            document.getElementById("progressBar").innerHTML = `${isImmunePercent.toFixed(2)}%`;
            document.getElementById("update-date").innerHTML = new Date(csvVaccArr.last()[0]).toLocaleDateString("de-AT")
            
            
//            const chartRows = csvVaccArr.filter(row => row[1] === '10');
            const ctx = document.getElementById("vaccChart").getContext("2d");

            const vaccDiffSum = csvVaccArr.map(row => row[1]).flat().map((e, i, arr) => ((arr[i] - arr[i - 7]) / 7).toFixed(0)).slice(8);
            const vaccDiffFirst = csvVaccArr.map(row => row[8]).flat().map((e, i, arr) => ((arr[i] - arr[i - 7]) / 7).toFixed(0)).slice(8);
            const vaccDiffSecond = csvVaccArr.map(row => row[9]).flat().map((e, i, arr) => ((arr[i] - arr[i - 7]) / 7).toFixed(0)).slice(8);

            Chart.defaults.global.elements.point.radius = '0';
//                Chart.defaults.global.elements.point.backgroundColor = 'rgba(0, 0, 0, 0)';

            const myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: csvVaccArr.map(row => new Date(row[0]).toLocaleDateString("de-AT")).flat().slice(8),
                    datasets: [{
                        label: "Vollimmun",
                        data: vaccDiffSecond,
                        fill: true,
                        lineTension: 0,
                        backgroundColor: 'rgba(27, 139, 255, 1)'
                    }, {
                        label: "Erste Impfung",
                        data: vaccDiffFirst,
                        fill: true,
                        lineTension: 0,
                        backgroundColor: 'rgba(132, 192, 255, 1)'
                    },
                    {
                        label: "Gesamt",
                        data: vaccDiffSum,
                        fill: true,
                        lineTension: 0,
                        backgroundColor: 'rgba(171, 210, 251, 1)'
                    }]
                },
                options: {
                    title: {
                        display: false,
                        text: 'Impfrate 7-Tage-Schnitt'
                    },
                    aspectRatio: window.screen.width < 600 ? 1 : 2,
                    tooltips: {
                        mode: 'x'                            
                    },
                    scales: {
                        xAxes: [{
                                ticks: {
                                    autoSkipPadding: 10
                                }                                   
                        }]
                    }
               }
            });
        });
        
        $.get("data/RKI_Key_Data.csv?_=" + new Date().getTime(), function(result) {
            const data = result.split("\n").map(element => element.split(",")).slice(1, -1);
            
            document.getElementById("recovered").innerHTML = data.reduce((total, currentValue) => total + currentValue[8].toInt(), 0).toLocaleString("de-AT");
            document.getElementById("recoveredDelta").innerHTML = data.reduce((total, currentValue) => total + currentValue[9].toInt(), 0).toSignedString("de-AT");
            document.getElementById("infected").innerHTML = data.reduce((total, currentValue) => total + currentValue[3].toInt(), 0).toLocaleString("de-AT");
            document.getElementById("infectedDelta").innerHTML = data.reduce((total, currentValue) => total + currentValue[5].toInt(), 0).toSignedString("de-AT");
            document.getElementById("casualties").innerHTML = data.reduce((total, currentValue) => total + currentValue[4].toInt(), 0).toLocaleString("de-AT");
            document.getElementById("casualtiesDelta").innerHTML = data.reduce((total, currentValue) => total + currentValue[6].toInt(), 0).toSignedString("de-AT");
//            document.getElementById("hospital").innerHTML = hospital.toLocaleString("de-AT");
//            document.getElementById("hospitalDelta").innerHTML = hospitalDelta.toSignedString();
//            document.getElementById("intensiveCare").innerHTML = intensiveCare.toLocaleString("de-AT");
//            document.getElementById("intensiveCareDelta").innerHTML = intensiveCareDelta.toSignedString();
//            document.getElementById("tests").innerHTML = tests.toLocaleString("de-AT");
//            document.getElementById("testsDelta").innerHTML = testsDelta.toSignedString();
            document.getElementById("infectedCurrent").innerHTML = data.reduce((total, currentValue) => total + currentValue[10].toInt(), 0).toLocaleString("de-AT");
            document.getElementById("infectedCurrentDelta").innerHTML = data.reduce((total, currentValue) => total + currentValue[11].toInt(), 0).toSignedString("de-AT");
            document.getElementById("incidence").innerHTML = (data.reduce((total, currentValue) => total + currentValue[12].toFloat(), 0) / data.length - 2).toFixed(2);
//            document.getElementById("incidenceDelta").innerHTML = Math.round(incidenceDelta).toSignedString();
        });
        
        function toggleChangelog(elem) {            
            elem.classList.toggle("toggle");
        }
    </script>
</html>
